require('stringr')

planets <- readLines('data/planets.txt', warn=FALSE)
fid <- file('js/template.js', 'w')
cat("templates = {};\n", file=fid)

planet <- list()
days <- FALSE
inz <- FALSE
speed <- 10

for (line in planets) {
    line <- str_trim(line)
    char <- substr(line, 1, 1)
    
    
    if (char == "[") {
        pname <- substr(line, 2, str_length(line)-1)
        cat(sprintf("templates['%s'] = {}; templates['%s'].x = [];\n", pname, pname), file=fid)
        days <- FALSE
        inz <- FALSE
        speed <- 10
    }
    else if (char == "/") {
        what <- substr(line, 2, 2)
        if (what == "z")
            inz <- TRUE
        if (what == "d")
            days <- TRUE
        if (what == "s")
            speed <- as.numeric(substr(line, 3, str_length(line)))
        if (what == "t")
            cat(sprintf("templates['%s'].dt = %e\n", pname, as.numeric(substr(line, 3, str_length(line)))), file=fid)
    }
    else if (line == "")
        next
    else {

        nums <- as.numeric(strsplit(line, '\\s+')[[1]])
        if (inz) {
            y <- nums[3]
            z <- nums[4]
            vy <- nums[6]
            vz <- nums[7]
            nums[4] <- y
            nums[3] <- z
            nums[6] <- vz
            nums[7] <- vy
        }

        cat(sprintf("templates['%s'].x.push([", pname), file=fid)
        cat(sprintf("%e,", nums), file=fid)
        cat(sprintf("%d]);\n", speed), file=fid)
    }
    
    
}

close(fid)
