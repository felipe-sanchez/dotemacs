#+OPTIONS: tex:dvipng
#+STARTUP: latexpreview, inlineimages, entitiespretty, showall
#+HTML_HEAD: <link rel="stylesheet" type="text/css" href="http://thomasf.github.io/solarized-css/solarized-light.min.css" />

* MCDM/Simple

** Introduction
A Monte Carlo code modeled on Zsom et al., 2010.

** Numerical algorithm
The algorithm follows the evolution of n _representative_ particles
out of N _physical_ particles. The particles are tracers of the
underlying distribution (think SPH: particles tracing the density distribution).


At each step, rng decides which particles collide, and a function decides the collisional outcome.

Algorithm:
- Start with n particles with mass m_i. The representative particles (n
  \ll N) will only collide with physical particles.
- Choose a particle, say i = 20; what particles will collide with it?
  Assume physical particles are distributed the same -- then for each
  value k = 1..n, there are $n_k = M_tot/nm_k \times V$ physical
  particles per cubic cm with mass m_k. I.e. each representative
  particle i represents $M_{tot}/nm_i$ physical particles.
- The rate of collision is  $r_i(k) = n_k \sigma_ik \Delta{}v_ik = M_{tot} / nm_k V \sigma_{ik}
  \Delta{}v_{ik}$ between particles i and k; then the rate of collisions for
  particle i is r_i=\sum{}r_ik and the total rate is r = \sum_i r_i.
- Choose a timestep \delta{}t = -1/r log(ran()) (it's a Poisson process) -> 1
  collision event.
- P(i) = r_i/r is the probability that there's a collision with
  particle i; P(k|i) = r_i(k)/r_i probability of k is involved in the
  collision. (i and k can be equal).

** Initialization
- Initially, it is assumed that all the mass in solid is distributed between R = R_min and R_fill as dN/dR = N_0 R^{-pg}; \rho is assumed constant (e.g. = 2 g/cm^3). Therefore, M_tot = \int N_0 R^{-pg} M dR = 4/3 \pi \rho N_0 \int R^{-pg+3} dR \rightarrow N_0 = M (4-pg) / (4/3 \pi\rho R_{fill}^{4-pg})

- M_tot is distributed in two ways; between 0 and R_dust it goes in the M_dust bin (where we don't follow the detailed evolution of radii). The rest is initially going into the MC particles, distributed between R_dust and R_fill.

** Evolution
- First, calculate r_ik (a lower triangular matrix if r_i(k) = M_tot/nV \sigma_{ik}\Delta v_ik; notice I removed the m_k factor and will add it later when calculating sums, so that the expression is symmetric). r_ik is the "collision rate" matrix.
- Next, calculate the rate at which material in the [R_snowball, R_boulder ] range is converted into material in the [R_{planetesimal1}, R_{planetesimal2}] range. At each step, take a planetesimal mass M_pl (sampled from a distribution dN/dR ~ R^{-pp}; pp = 0 by default), and calculate the rate of planetesimal production as 

  dN/dt = M_available/M_{pl}\tau = M_{available}/M_pl \epsilon_{pl}\Omega/2\pi
  \rightarrow r_pl = (dN/dt)^{-1}

  (where M_{available} is the mass available to create planetesimals, \epsilon_{pl}
  is the efficiency and \Omega the local angular speed).
- The total rate is r = \sum_i \sum_k r_ik + r_pl. Choose dt = -1/r log(rng()).
- Choose a number q between 1 and r; if q > \sum_i \sum_k r_ik, then collision, otherwise conversion.
  - Collision: probability happening to particle i is P(i) = r_i/r, so select particle according to r_i distribution.
  - then, choose k such that P(k|i) = r_ik/r_i, then compute outcome (still WIP).
- Conversion: choose the particle i that will be converted among the ones that participate in conversion, and substitute its characteristics (M and R) with the planetesimal's.

** Implementation
- The main code is in src/main.c. 
- Variables between in the PARAMETERS block are read either from the command line or from a bloc. They are normalized by AU, MSUN and G=1 (so the time unit is ~.16 years).
- The code is parallelized using MPI. Each process runs with the same parameters but different seeds -- the plotting code can then average the outputs. At each dt_out, the following data is printed:
  - output.%04d.txt: all the MC particles, listed by mass and radius (in internal units)

* Physics

** Encounter speeds
*** Small particles
- Say for R < 10^5 cm (Windmark, 2012), the encounter velocities are detemined by Brownian motion, drift (radial + azimuthal) and turbulent torques. For particles > 10 \mu{}m, Brownian motion is unimportant.

- Encounter speeds from turbulence (Ormel 2007):

Stopping time:
t_s = 3/4 m/(\sigma c_g \rho_g)

Stokes number:
St = \Omega t_s  (t_L \approx \Omega^{-1} is the overturn time of the largest eddy)

Reynolds number:
Re = \alpha c_g H_g/\nu (\approx 10^{14} or so)

- Closed-form formulas (Garaud 2007):

Take eddy velocity v_e ~ \alpha^{1/2} c_g, dynamical timescale \tau_d ~ \Omega^{-1}, eddy turnover timescale at the dissipation scale \tau_\nu ~ \tau_d Re^{-1/2}. Then get \Delta v(R, R') for two particles R and R' with stopping times t_s(R) and t_s(R').


*** Large particles
For R > 10 meters, if turbulence is strong (\alpha > 10^-3), we could assume relative velocities are driven by turbulent torques (instead of turbulnt drag). 


* Bibliography
** Blum14
- Inside the snow line: direct sticking (of particles colliding at slow speeds, or high speeds impacts leading to fragmentation with mass transfer; in principle works to form planetesimals, in practice long timescales), or streaming instability (but what is the final mass function of planetesimals? also mention of high metallicity requirements, with deserves further reading)
- Outside the snow line, icy material is stickier, so perhaps hit-and-stick process to form cometesimals.
- Distinct predictions in the formation of cometesimals via mass transfer (MT) vs. gravitat. instability (GI) (filling factor, tensile strength, gas permeability, etc.)
- Skorov&Blum '12 model: formed in GI.
- Observationally: cm to dm size particles aggregated; macroscopic agglomerations.
- mm \rightarrow cm growth understood for dust-aggregate collsions; for ice, expected to be (a) stickier (b) at different collision speeds around 30 AUs or so.
- Formation process needs to be "gentle" to explain tensile strength of the surface layers of dust (see lab experiments), i.e. a GI-driven formation process.



** Johansen14
- Bodies are held together by self-gravity, rather than by tensile strength, around 100-1000 meters.
- Planetesimals and pre-planetesimals (~10 m in size)'s velocities is excited mainly by stochastic gravitational pull. At high turbulences, sizes as large as 1,000 km are required to start run-away growth, e.g. gravitational focusing not important. This might be an important component of the paper, since (a) we don't want to treat run-away growth (beyond a certain size you need to worry about having real particles + dynamics, I would think), (b) not as many bodies quickly reach big sizes. This is important as in my code, the number of ``physical'' particles scales as

 N_{i, phys} = M_solids/(N_representative m_{i, phys})

 for the i-th particle; e.g. the more massive the particle, the fewer physical particles there are. This can become problematic as you are no longer counting on a large ensemble of particles. (c) I have experience with the turbulent torque model, so I potentially could think about how to include this self-consistently in the model. Or at least, perhaps model eccentricity/inclination growth? (Actually, not sure I would know how to treat the inclination since the strength of the torques will increase as you go up in z, would need to check Gressel'12). 

 _However_, remember that in the mid-plane turbulent fluctuations are not as strong. Perhaps 1% of the strength of the TT is the residual torque in the midplane -> 1 to 10 km may have sufficient focusing.

*** Belts
**** Asteroid belt
- N \propto D^{-3.5} (cumulative distribution) for bodies above 100 km in diameter; N \propto D^{-1.8} for bodies below (compare to N\propto D^{1-q} with q = 3.5 for Dohnanyi's dist.). Broken power law with "knee" at ~100 km.
- Two classes: low albedo and high albedo. Different formation events? The largest bodies are differentiated. 
- Distribution modified by dynamical depletion + erosion. Bottke05 argues large (>100 km) asteroids are primordial, steep size distribution resembles formation size (in accordance with concentration models). Weidenschilling11 finds the knee can be reproduced with sub-km initial sizes.
**** Meteorites
- Chondrites vs. differentiated. CAIs oldest material to crystallise (mm-cm) + chondrules (~mm). Chondrule + CAI formation lasted ~3 Myr. Radioactive elements (e.g. 26Al) provided heat for differentiation. Probably constitute the main components of primordial asteroids.
**** Trans-Neptunian objects
- High fraction of equal-mass binaries, limits amount of collisional grinding (Nesvorny11). Similar distribution to asteroid belt with knee at ~100 km. "Missing intermediate-size planetesimals": evidence of large birth size?
**** Comets
- Formation beyond 15-30 AU
- Quite porous; whether large-scale porosity (rubble piles) vs. small-scale porosity (pebble piles) not known. Shoemaker-Levy 9 strengthless rubble pile.
- Pristine? If large initial planetesimals, they would be formed by grinding. Problem: volatile elements would not survive collisions. Alternative is tidal disruption by close incounters; problem: if the large planetesimal undergoes differentiation, no way to break it up.
- Appears that they avoided melting by 26Al; born 26Al poor- or free-? CAIs are also found in comets (formed at high temperatures), so there's also efficient outward transport.
**** Debris disks
- Debris disks common around < 50 Myr stars (30%), falls quickly after 100-1000 Myr.

*** Planetesimal formation stage
**** Drag force
- Small particles coupled as $\dot{v} = -1/\tau_f ( v-u)$ (v particle velocity, u gas velocity, \tau_f friction time). 
- Friction time divided into different regimes (Epstein vs. Stokes vs. quadratic). Epstein for small particles (smaller than mean free path), so that \tau_f = R\rho_\odot/c_s \rho_g (independent of relative speed). Transition to quadratic regime at high Reynolds values (Re = 2R\delta{}v/\nu > 800) (with friction time \tau_f = 6R\rho/\delta{}v\rho_g). 
- Step wise transition between regimes.
- Stokes number St = \Omega\tau_f, sets scale for turbulent collision speeds, sedimentation, drift, concentration in pressure bumps and streaming instability.

**** Drift
- Nominal sub-Keplerian speed \Delta{}v \approx 50m/s.
- Radial drift \prop (St + St^{-1})^{-1}, so maximum at St ~ 1. Particles either sublimate at condensation fronts (e.g. at snow lines), or can be instable to the streaming instabilities.

Continue...
