<?php 
$link = @mysql_connect('localhost', 'mathalic_system', 'ZioPorc1!');
mysql_select_db('mathalic_systemic');
function mysql_insert($table, $inserts) {
		
	$vals = $inserts;
	if (count($vals) == 0)
		return false;
	$vals = array_map('mysql_real_escape_string', $vals);
	return mysql_query('INSERT INTO `'.$table.'` (`'.implode('`,`', array_keys($vals)).'`) VALUES (\''.implode('\',\'', $vals).'\')');
}

$name = $_POST["name"];
$email = $_POST["email"];
$affiliation = $_POST["affiliation"];
$product = $_POST["product"];
$comments = $_POST["comments"];
$browserstring = $_POST["browserstring"];

if (!isset($_POST["product"]) || trim($_POST["product"]=="")) {
  header("Location: http://www.stefanom.org");
  return;
}
if (!isset($_POST["name"])) {
  $name = "NOT_SPECIFIED";
}

$pararray = array(name => $name, email => $email, affiliation => $affiliation, product => $product, comments => $comments, browserstring => $browserstring);


setcookie("registered" . rawurlencode($product), "true", time()+60*24*3600, '/');
if (!mysql_insert('registered', $pararray)) {
  print(mysql_error());
  return;
}
mail("stefano@stefanom.org", "[Systemic] Registration for " . $product,
     json_encode($pararray));
sleep(8);
if (isset($_GET["url"]))
  header("Location: " . $_GET["url"]);
else
  header("Location: http://www.stefanom.org");

?>
